import { defineStore } from 'pinia'
import { ROLES } from './auth'

export const BLOCKS = [
	{ id: 'intro-company', title: 'Знакомство с компанией' },
	{ id: 'onboarding', title: 'Введение в должность' },
	{ id: 'mandatory', title: 'Обязательное обучение' },
	{ id: 'development', title: 'Развитие' },
]

export const STATUSES = {
	NOT_PASSED: 'не пройдено',
	PASSED: 'пройдено',
	VERIFIED: 'проверено',
}

// Role-based content for blocks 2-4
const rolePrograms = {
	[ROLES.METHODIST]: {
		onboarding: [
			{ id: 'md-onb-1', title: 'Введение в дистанционное образование', type: 'page', content: 'Определение ДО; модели: синхронная и асинхронная.\nПреимущества: масштабируемость, гибкость, персонализация траекторий.\nОграничения: поддержание мотивации, цифровой разрыв, среда обучения.\nРоли участников: продюсер, SME, методист, дизайнер, тьютор, техническая поддержка.\nКлючевые риски и способы их снижения.' },
			{ id: 'md-onb-2', title: 'Онлайн-сервисы и инструменты', type: 'page', content: 'LMS: структура курса, роли и права, отчёты и аналитика.\nКонструкторы тестов и опросов: банки вопросов, рандомизация, метрики качества.\nСовместная работа: борды/таск‑трекинг, редакторы документов, версии.\nКоммуникации: чаты, форумы, видеосозвоны; этикет, SLA, протоколирование решений.' },
			{ id: 'md-onb-3', title: 'Программы обучения', type: 'page', content: 'Цели и результаты обучения (LO): таксономии Bloom/Anderson.\nУчебно‑тематический план: модули, темы, контрольные точки, трудоёмкость.\nConstructive alignment: выравнивание контента, активностей и оценивания под LO.\nКритерии качества: актуальность, практическая ценность, измеримость, доступность (a11y).' },
			{ id: 'md-onb-4', title: 'Функции методиста образовательных программ', type: 'page', content: 'Сбор требований и декомпозиция компетенций в LO.\nПроектирование активностей, критериев и рубрик оценивания.\nСопровождение SME: шаблоны, брифы, чек‑листы, ревью материалов.\nКонтроль качества: пилот, сбор обратной связи, итерации улучшений.' },

		],
		mandatory: [
			{ id: 'md-man-1', title: 'Верхнеуровневые алгоритмы проектирования', type: 'page', content: 'Жизненный цикл: Анализ→Дизайн→Разработка→Внедрение→Оценка (ADDIE).\nАртефакты: бриф, план, сценарии, макеты, рубрики, отчёты.\nКонтрольные точки: ревью концепта, пилот, релиз, пост‑анализ.' },
			{ id: 'md-man-2', title: 'Каналы коммуникации', type: 'page', content: 'Матрица коммуникаций: кто/что/когда/как; календарь встреч.\nПравила e‑mail/чат/видео: повестка, протокол, хранение решений.\nУправление рисками и эскалациями; единые шаблоны документов.' },
			{ id: 'md-man-3', title: 'Модели проектирования', type: 'page', content: 'ADDIE vs SAM: сравнительная применимость.\nТаксономии Bloom/Anderson для формулировки LO.\nДевять событий обучения Ганье: внимание→практика→обратная связь.' },
			{ id: 'md-man-4', title: 'Форматы учебных активностей', type: 'page', content: 'Подбор формата под LO и аудиторию: видео, практикумы, кейсы, симуляции, проекты.\nТребования к материалам и оцениванию по формату.\nИнклюзивность, когнитивная нагрузка, микрообучение.' },
			{ id: 'md-man-5', title: 'Мотивационный дизайн программы', type: 'page', content: 'ARCS: внимание, релевантность, уверенность, удовлетворённость.\nГеймификация: уровни, бейджи, челленджи, лидерборды.\nПоддержка прогресса: напоминания, микро‑цели, регулярная обратная связь.' },
		],
		development: [
			{ id: 'md-dev-1', title: 'Создание практических заданий', type: 'page', content: 'Типы: тренировочные, проверочные, проектные.\nSMART‑постановка, критерии и рубрики; примеры и анти‑примеры.\nБаланс сложности и ресурсоёмкости для студента и проверяющего.' },
			{ id: 'md-dev-2', title: 'Разработка тестов', type: 'page', content: 'Типы вопросов: MCQ, множественный выбор, соответствия, открытые.\nКачество тестов: валидность, надёжность, сложность, дискриминация.\nБанки вопросов, рандомизация, контроль утечек.' },
			{ id: 'md-dev-3', title: 'Проектирование образовательных материалов', type: 'page', content: 'Информационная архитектура, визуальная иерархия, читаемость.\nКогнитивная нагрузка, мультимодальность, доступность (a11y).\nГайдлайны, шаблоны, единый стиль.' },
			{ id: 'md-dev-4', title: 'Оценивание деятельности и мотивации', type: 'page', content: 'Формативное vs суммативное оценивание.\nМетрики: completion, engagement, quiz‑score, ретензия.\nКачественная обратная связь, петля улучшений.' },

		],
	},
	[ROLES.DIRECTOR]: {
		onboarding: [
			{ id: 'dr-onb-1', title: 'Введение в дистанционное образование', type: 'page', content: 'Принципы и особенности дистанционного обучения для режиссуры курсов.' },
			{ id: 'dr-onb-2', title: 'Онлайн-сервисы и инструменты', type: 'page', content: 'Платформы для видеопроизводства, планирования и коммуникаций.' },
			{ id: 'dr-onb-3', title: 'Ресурсы и доходы проекта', type: 'page', content: 'Планирование ресурсов, бюджеты и источники доходов проекта.' },
			{ id: 'dr-onb-4', title: 'Функции режиссера онлайн-курсов', type: 'page', content: 'Роль режиссёра, взаимодействие с авторами и командой.' },
		],
		mandatory: [
			{ id: 'dr-man-1', title: 'Выбор проекта для работы на курсе', type: 'page', content: 'Критерии отбора тем и проектов, оценка рисков.' },
			{ id: 'dr-man-2', title: 'Анализ рынка перед запуском курса', type: 'page', content: 'Анализ конкурентов, аудитории и позиционирования.' },
			{ id: 'dr-man-3', title: 'Разработка концепции онлайн-курса', type: 'page', content: 'Концепт, формат, сценарии и согласование.' },
			{ id: 'dr-man-4', title: 'Разработка структуры программы', type: 'page', content: 'Декомпозиция на модули, уроки, блоки практики.' },
			{ id: 'dr-man-5', title: 'Съёмки курса и оборудование для съёмки', type: 'page', content: 'Подготовка площадки, свет, звук, оборудование и процессы съёмки.' },
		],
		development: [
			{ id: 'dr-dev-1', title: 'Проектирование домашних заданий', type: 'page', content: 'Практикоориентированные задания и проверка результата.' },
			{ id: 'dr-dev-2', title: 'Ошибки при работе с авторами, спикерами и партнёрами', type: 'page', content: 'Типичные ошибки и способы их предотвращения.' },
			{ id: 'dr-dev-3', title: 'Анализ и оценка качества курса', type: 'page', content: 'Метрики качества, обратная связь и улучшения.' },
			{ id: 'dr-dev-4', title: 'Как работать с LMS', type: 'page', content: 'Интеграция контента, трекинг прогресса и аналитика в LMS.' },
		],
	},
	[ROLES.SUPPORT]: {
		onboarding: [
			{ id: 'sp-onb-1', title: 'Введение в дистанционное образование', type: 'page', content: 'Основы дистанционного обучения и роль поддержки клиентов.' },
			{ id: 'sp-onb-2', title: 'Онлайн-сервисы и инструменты', type: 'page', content: 'Системы тикетов, чаты, телефония, CRM.' },
			{ id: 'sp-onb-3', title: 'Введение в EdTech-маркетинг', type: 'page', content: 'Каналы, воронка, влияние поддержки на маркетинг.' },
			{ id: 'sp-onb-4', title: 'Функции специалиста отдела поддержки клиентов', type: 'page', content: 'Задачи, KPI, тон общения, маршрутизация запросов.' },
		],
		mandatory: [
			{ id: 'sp-man-1', title: 'Платформы для видеоконференций и вебинаров', type: 'page', content: 'Zoom, MS Teams, Webinar и др., частые проблемы и решения.' },
			{ id: 'sp-man-2', title: 'Работа с клиентами', type: 'page', content: 'Скрипты, работа с возражениями, NPS/CSAT.' },
			{ id: 'sp-man-3', title: 'Продажи. Анализ запуска', type: 'page', content: 'Согласование с продажами, обратная связь по старту.' },
			{ id: 'sp-man-4', title: 'Разработка финансовой модели и плана проекта', type: 'page', content: 'Роль поддержки в планировании ресурсов и SLA.' },
			{ id: 'sp-man-5', title: 'Оценка эффективности продвижения', type: 'page', content: 'Метрики откликов, конверсии из обращений.' },
		],
		development: [
			{ id: 'sp-dev-1', title: 'Таргетированная реклама', type: 'page', content: 'Основы таргетинга и взаимодействие поддержки с маркетингом.' },
			{ id: 'sp-dev-2', title: 'SMM: продвижение в социальных сетях', type: 'page', content: 'Модерация, ответы, тональность, SLA по соцсетям.' },
			{ id: 'sp-dev-3', title: 'Email-маркетинг', type: 'page', content: 'Поддержка рассылок, обработка ответов, автоответы.' },
			{ id: 'sp-dev-4', title: 'Дополнительные возможности продвижения бренда', type: 'page', content: 'Партнёрства, комьюнити, база знаний, self-service.' },
		],
	},
}

// Block 1 is common for all roles
const commonIntroTopics = [
	{ id: 'c1', title: 'Миссия и ценности', type: 'page', content: `Сведения об образовательной организации \n 
		Полное наименование организации — Общество с ограниченной ответственностью «Цифровое образование». 
		Сокращенное наименование организации — ООО «Цифровое образование». 
		Полное наименование организации на английском языке — Limited liability company «Digital Education». 
		Сокращенное наименование на английском языке — LLC «Digital Education». 
		Дата создания организации — 14.07.2020. 
		Учредитель организации — Половинкин Алексей Евгеньевич. 
		Место нахождения организации — 123112, г. Москва, вн.тер.г. муниципальный округ Пресненский, Пресненская наб., д. 10, стр. 2, помещ. 87. 
		Режим и график работы организации — офис работает с понедельника по пятницу с 10.00 до 19.00. 
		Контактные телефоны организации — +7 495 280 72 55. 
		Адреса электронной почты организации: info@cifrium.group. 
		Мессенджеры: t.me/cifrium. 
		Место осуществления образовательной деятельности — 123 112, г. Москва, вн.тер.г. муниципальный округ Пресненский, Пресненская наб., д. 10, стр. 2, помещ. 87.`},
	{ id: 'c2', title: 'Оргструктура', type: 'page', content : `
Органы управления организацией. \n	
Генеральный директор — Половинкин Алексей Евгеньевич 
Коллегиальные органы управления: Общее собрание 
Структурные подразделения.
o	Администрация
o	Отдел клиентского сервиса
o	Проектный офис
o	Департамент корпоративных проектов
o	Отдел проектирования корпоративных программ
o	Отдел прямых продаж в образовательные учреждения
o	Учебно-методический департамент
o	Департамент развития бренда и коммуникаций
o	Департамент разработки цифрового продукта
o	Департамент цифрового продукта
o	Департамент стратегических коммуникаций
o	Направление Талантливые дети \n
Место нахождения всех структурных подразделений и органов управления: 123112, г. Москва, вн.тер.г. муниципальный округ Пресненский, Пресненская наб., д. 10, стр. 2, помещ. 87
`},
{id: 'c3', title: 'Образование', type: 'page', content : `Вид – дополнительное образование
Подвиды: дополнительное профессиональное образование, дополнительное образование детей и взрослых.
Адаптированные образовательные программы не реализуются.
Форма обучения – очная.
Язык образования – русский язык
Нормативный срок обучения устанавливается образовательной программой Общая численность обучающихся - 6 112 человек (за 2024 год).
Численность обучающихся по реализуемым образовательным программам за счет бюджетных ассигнований, федерального бюджета, бюджетов субъектов РФ, местных бюджетов — 0 человек.

o	Численность обучающихся являющихся иностранными гражданами — 0 человек.
Лица с ограниченными возможностями здоровья отсутствуют, не обучаются.
Практика по реализуем дополнительным общеобразовательным программам учебными планами не предусмотрена.
Образовательная программа представляет собой комплекс основных характеристик образования (объем, содержание, планируемые результаты), организационно- педагогических условий и форм аттестации, который представлен в виде:
o	Учебного плана;
o	Учебно-тематического плана;
o	Пояснительной записки
o	Рабочих программ;
o	Календарного учебного графика;
o	Оценочных материалов (билеты, тесты и т. д.);
o	Учебно-методических материалов (учебники, раздаточные материалы; методические указания, плакаты, слайды, интернет-ресурсы).

ООО «Цифровое образование» оказывает следующие платные образовательные услуги: услуги по реализации дополнительных общеобразовательных программ; услуги по реализации образовательных программ дополнительного профессионального образования.
Материально-техническое обеспечение и оснащенность образовательного процесса. Доступная среда
В ООО «Цифровое образование» созданы условия для функционирования электронной информационно-образовательной среды, включающей в себя:
o	электронные информационные ресурсы,
o	электронные образовательные ресурсы,
o	совокупность соответствующих информационных технологий, телекоммуникационных технологий, технологических средств.
Электронная образовательная среда ООО «Цифровое образование» обеспечивает освоение обучающимися образовательных программ в полном объеме независимо от их места нахождения.
`},
{id: 'c4', title: 'Дистанционное обучение', type: 'page', content : `Дистанционное обучение реализуется на платформах: \n
https://edu.olymponline.ru;
https://mo.olymponline.ru;
https://do.cifrium.ru;
https://innagrika.cifrium.ru;
https://kapitsaftl.ru;
https://it-technolyceum.ru;
https://unti.cifrium.ru;
https://dksta.cifrium.ru;
https://kb.cifrium.ru/;
https://ege.cifrium.ru.\n
•	Доступ к электронным материалам, размещенным на электронных платформах (включая, но не ограничиваясь, тексты конспектов, презентации, видеоматериалы, методические материалы, задачи и тренажеры и т.п.), предоставляется обучающимся в порядке, указанном в договорах на реализацию образовательных программ. Помещения для проведения занятий, в том числе с использованием дистанционных образовательных технологий, расположены по адресу: 123112, г. Москва, вн.тер.г. муниципальный округ Пресненский, Пресненская наб., д. 10, стр. 2, помещ. 87.
Учебные помещения подключены к сети интернет. Имеется дополнительное оборудование для проведения видеоконференций и занятий в дистанционном режиме. В ООО «Цифровое образование» обеспечивается доступ инвалидов и лиц с ограниченными возможностями к информационным системам и электронным образовательным ресурсам.
•	Финансирование образовательной деятельности, осуществляемой ООО «Цифровое образование», за счет бюджетных ассигнований федерального бюджета, бюджетов субъектов Российской Федерации, местных бюджетов не предусмотрено.\n
•	Стипендии и меры поддержки обучающихся
•	Стипендии и меры социальной поддержки обучающимся ООО «Цифровое образование» не предоставляются.
Общежития, интернаты в ООО «Цифровое образование» отсутствуют.\n
•	Международное сотрудничество
•	ООО «Цифровое образование» не имеет: заключенных и планируемых к заключению договоров с иностранными и (или) международными организациями по вопросам образования и науки; образовательных программ, имеющих международную аккредитацию.\n
•	Организация питания в образовательной организации
•	В ООО «Цифровое образование» в режиме учебных занятий предусмотрены перерывы для организации питания обучающихся. С учетом осуществления образовательной деятельности с использованием электронного обучения и дистанционных образовательных технологий, организацию питания обучающихся осуществляют их родители (законные представители).
`},
{id: 'c5', title: 'Документы для ознакомления', type: 'page', content : `https://storage.yandexcloud.net/wk-homeschool/homeschool/uploads/inner_file/file/834/ustav_DO_NOT_DELETE.pdf - Устав
https://storage.yandexcloud.net/wk-homeschool/homeschool/uploads/inner_file/file/835/polozh_DO_NOT_DELETE.pdf - Положение о порядке отчисления, восстановления и перевода обучающихся
https://storage.yandexcloud.net/wk-homeschool/homeschool/uploads/inner_file/file/837/attest_DO_NOT_DELETE.pdf - Положение о проведении текущего контроля
https://storage.yandexcloud.net/wk-homeschool/homeschool/uploads/inner_file/file/838/oform_DO_NOT_DELETE.pdf - Порядок оформления и выдачи документов о квалификации
https://storage.yandexcloud.net/wk-homeschool/homeschool/uploads/inner_file/file/839/pravila_DO_NOT_DELETE.pdf - Правила оказания платных образовательных услуг
`},
]

export const useTrainingStore = defineStore('training', {
	state: () => ({
		progressByUser: JSON.parse(localStorage.getItem('progressByUser') || '{}'),
		deadlinesByUser: JSON.parse(localStorage.getItem('deadlinesByUser') || '{}'),
		quizzesByBlock: {
			'intro-company': [
				{ text: 'Дистанционное обучение в компании реализуется на платформах', options: ['https://mirapolis.lawacademy.ru', 'https://edu.olymponline.ru', 'https://do.cifrium.com', 'https://skillbox.ru'], correct: 1 },
				{ text: 'Основной целью деятельности общества «Цифровое образование» является', options: ['осуществление информационных услуг', 'осуществление образовательной деятельности', 'осуществление научно-технологической деятельности', 'оказание консультационных услуг'], correct: 2 },
				{ text: 'Образовательная программа онлайн-курсов обязательно включает в себя:', options: ['учебно-тематический план', 'рабочую программу', 'учебные и оценочные материалы', 'все вышеперечисленное'], correct: 3 },
				{ text: 'В ООО «Цифровое образование» созданы условия для электронной ИОС, включающей:', options: ['учебные классы с персональными компьютерами', 'учебные классы с проектором', 'электронные образовательные ресурсы', 'сеть Интернет'], correct: 2 },
				{ text: 'Существует ли возможность оффлайн-обучения в компании:', options: ['нет, только онлайн-обучение', 'да, есть учебные помещения в здании компании', 'да, есть учебные помещения в филиалах компании', 'обучение можно осуществлять в школах'], correct: 1 },
				{ text: 'Имеется ли возможность обучения лиц с ОВЗ:', options: ['нет', 'да', 'да, только в филиалах компании', 'возможно в будущем'], correct: 1 },
				{ text: 'Порядок взимания платы за обучение слушателей:', options: ['обучение полностью бесплатное', 'есть бесплатные курсы', 'есть бесплатные демо-версии', 'обучение полностью платное'], correct: 3 },
				{ text: 'Если ли иностранные представительства в «Цифровое образование»?', options: ['да', 'нет'], correct: 1 },
				{ text: 'Предоставляются ли стипендии и меры соцподдержки обучающимся ООО «Цифровое образование»?', options: ['да', 'нет'], correct: 1 },
				{ text: 'Какие возможности предоставляются обучающимся:', options: ['онлайн-уроки с учителем', 'онлайн-материалы для обучения, вебинары', 'тестирование', 'все вышеперечисленное'], correct: 3 },
			],
			'onboarding': [
				{ text: 'Что отличает синхронное обучение от асинхронного?', options: ['Реальное время vs по расписанию', 'Реальное время vs в удобное время', 'Индивидуально vs в группе', 'Очно vs онлайн'], correct: 1 },
				{ text: 'Какой инструмент лучше для управления задачами команды?', options: ['Электронная почта', 'Мессенджер', 'Доска задач/канбан', 'Текстовый документ'], correct: 2 },
				{ text: 'Что первым формулируют при проектировании программы?', options: ['Дизайн интерфейса', 'Бюджет', 'Цели и результаты обучения', 'Рекламный план'], correct: 2 },
			],
			'mandatory': [
				{ text: 'ADDIE включает этап:', options: ['Финансирование', 'Дизайн', 'Продажи', 'Режиссура'], correct: 1 },
				{ text: 'Какой канал не относится к учебным активностям?', options: ['Практикум', 'Симуляция', 'Проект', 'Реклама'], correct: 3 },
				{ text: 'Что важно для коммуникаций в проекте?', options: ['Случайные встречи', 'Единые шаблоны и календарь', 'Только голосовые чаты', 'Отсутствие фиксированных сроков'], correct: 1 },
			],
			'development': [
				{ text: 'Хорошее практическое задание должно иметь:', options: ['Высокую сложность', 'Нечёткие критерии', 'Понятные критерии оценивания', 'Редкие сроки'], correct: 2 },
				{ text: 'Для тестов валидность — это:', options: ['Соответствие целям измерения', 'Красота дизайна', 'Длина текста', 'Количество вопросов'], correct: 0 },
				{ text: 'В LMS важно уметь:', options: ['Игнорировать отчёты', 'Импортировать/экспортировать и смотреть аналитику', 'Только публиковать видео', 'Отвечать в чатах'], correct: 1 },
			],
		},
	}),
	getters: {
		getTopicsForRole: () => (role) => ({
			introCompany: commonIntroTopics,
			onboarding: rolePrograms[role]?.onboarding || [],
			mandatory: rolePrograms[role]?.mandatory || [],
			development: rolePrograms[role]?.development || [],
		}),
		getQuizForBlock(state) {
			return (blockId) => state.quizzesByBlock[blockId] || []
		},
		getUserProgress(state) {
			return (userId) => state.progressByUser[userId] || {}
		},
		getUserDeadlines(state) {
			return (userId) => state.deadlinesByUser[userId] || {}
		},
	},
	actions: {
		persist() {
			localStorage.setItem('progressByUser', JSON.stringify(this.progressByUser))
			localStorage.setItem('deadlinesByUser', JSON.stringify(this.deadlinesByUser))
		},
		getBlockStatus(userId, blockId) {
			const userProgress = this.progressByUser[userId] || {}
			return userProgress[blockId]?.status || STATUSES.NOT_PASSED
		},
		setBlockStatus(userId, blockId, status) {
			if (!this.progressByUser[userId]) this.progressByUser[userId] = {}
			if (!this.progressByUser[userId][blockId]) this.progressByUser[userId][blockId] = { score: null, status: STATUSES.NOT_PASSED }
			this.progressByUser[userId][blockId].status = status
			this.persist()
		},
		saveQuizResult(userId, blockId, scorePercent) {
			if (!this.progressByUser[userId]) this.progressByUser[userId] = {}
			this.progressByUser[userId][blockId] = {
				score: scorePercent,
				status: scorePercent >= 80 ? STATUSES.PASSED : STATUSES.NOT_PASSED,
			}
			this.persist()
		},
		setDeadline(userId, blockId, isoDateStr) {
			if (!this.deadlinesByUser[userId]) this.deadlinesByUser[userId] = {}
			this.deadlinesByUser[userId][blockId] = isoDateStr
			this.persist()
		},
	},
})

